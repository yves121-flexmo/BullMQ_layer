<!DOCTYPE html>
<html>
<head>
<title>readme.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="bullmq-mail-system---architecture-unifi%C3%A9e">BullMQ Mail System - Architecture Unifiée</h1>
<p>Ce projet fournit une <strong>couche d'abstraction complète</strong> au-dessus de BullMQ pour créer un système d'envoi de mails asynchrone robuste et scalable. L'architecture clarifie les concepts BullMQ et offre une interface simple pour gérer les queues, workers, événements et workflows.</p>
<h2 id="%F0%9F%8E%AF-objectif">🎯 Objectif</h2>
<p>Simplifier l'utilisation de BullMQ en fournissant :</p>
<ul>
<li>Une interface unifiée pour tous les composants</li>
<li>Une gestion automatique des schedulers et des événements</li>
<li>Des patterns prêts à l'emploi pour les cas d'usage courants</li>
<li>Une architecture modulaire et extensible</li>
<li>Une gestion robuste des erreurs et des retries</li>
</ul>
<h2 id="%F0%9F%8F%97%EF%B8%8F-architecture">🏗️ Architecture</h2>
<h3 id="vue-densemble-des-composants">Vue d'ensemble des composants</h3>
<pre class="hljs"><code><div>┌─────────────────┐
│   MailManager   │  ← Interface principale
└─────────────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│ Queue   │ │ Worker  │ │ Event   │ │ Flow    │
│Manager  │ │Manager  │ │Manager  │ │Manager  │
└─────────┘ └─────────┘ └─────────┘ └─────────┘
</div></code></pre>
<h3 id="%F0%9F%94%A7-composants-principaux">🔧 Composants Principaux</h3>
<h4 id="1-mailmanager-interface-principale">1. <strong>MailManager</strong> (Interface principale)</h4>
<ul>
<li>Point d'entrée unique pour toute l'application</li>
<li>Unifie tous les autres managers</li>
<li>Fournit des méthodes haut niveau simples</li>
<li>Gère l'initialisation et l'arrêt propre</li>
</ul>
<h4 id="2-queuemanager-gestion-des-queues">2. <strong>QueueManager</strong> (Gestion des queues)</h4>
<ul>
<li>Crée et gère toutes les queues BullMQ</li>
<li><strong>Créé automatiquement un scheduler pour chaque queue</strong></li>
<li>Gère les métriques et le nettoyage</li>
<li>Operations : pause, resume, clean, obliterate</li>
</ul>
<h4 id="3-workermanager-gestion-des-workers">3. <strong>WorkerManager</strong> (Gestion des workers)</h4>
<ul>
<li>Démarre et gère tous les workers</li>
<li>Route les jobs vers les bons handlers</li>
<li>Gère la concurrence et les performances</li>
<li>Fournit des handlers pré-définis pour les emails</li>
</ul>
<h4 id="4-eventmanager-syst%C3%A8me-d%C3%A9v%C3%A9nements">4. <strong>EventManager</strong> (Système d'événements)</h4>
<ul>
<li>Centralise tous les événements BullMQ</li>
<li>Listeners globaux et spécifiques par queue</li>
<li>Monitoring et audit automatiques</li>
<li>Alertes pour les échecs récurrents</li>
</ul>
<h4 id="5-flowmanager-workflows-complexes">5. <strong>FlowManager</strong> (Workflows complexes)</h4>
<ul>
<li>Gère les workflows avec dépendances</li>
<li>Patterns pré-définis (email, newsletter, retry)</li>
<li>Workflows conditionnels</li>
<li>Métriques et état des flows</li>
</ul>
<h2 id="%F0%9F%9A%80-installation">🚀 Installation</h2>
<pre class="hljs"><code><div>npm install bullmq ioredis dotenv
<span class="hljs-comment"># S'assurer que Redis est installé et en cours d'exécution</span>
brew install redis
brew services start redis
</div></code></pre>
<h2 id="%F0%9F%92%A1-utilisation">💡 Utilisation</h2>
<h3 id="exemple-basique">Exemple basique</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> MailManager = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./core/MailManager'</span>);
<span class="hljs-keyword">const</span> WorkerManager = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./core/WorkerManager'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">basicUsage</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Configuration</span>
  <span class="hljs-keyword">const</span> mailManager = <span class="hljs-keyword">new</span> MailManager({
    <span class="hljs-attr">redis</span>: { <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>, <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span> },
    <span class="hljs-attr">defaultOptions</span>: {
      <span class="hljs-attr">attempts</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">backoff</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'exponential'</span>, <span class="hljs-attr">delay</span>: <span class="hljs-number">2000</span> }
    }
  });

  <span class="hljs-comment">// Initialisation</span>
  <span class="hljs-keyword">await</span> mailManager.initialize();

  <span class="hljs-comment">// 1. Création d'une queue (avec scheduler automatique)</span>
  mailManager.createQueue(<span class="hljs-string">'emails'</span>);

  <span class="hljs-comment">// 2. Démarrage d'un worker</span>
  <span class="hljs-keyword">const</span> handlers = WorkerManager.createEmailHandlers();
  mailManager.startWorker(<span class="hljs-string">'emails'</span>, handlers, { <span class="hljs-attr">concurrency</span>: <span class="hljs-number">5</span> });

  <span class="hljs-comment">// 3. Ajout de jobs</span>
  <span class="hljs-keyword">await</span> mailManager.addJob(<span class="hljs-string">'emails'</span>, <span class="hljs-string">'send-welcome'</span>, {
    <span class="hljs-attr">to</span>: <span class="hljs-string">'user@example.com'</span>,
    <span class="hljs-attr">subject</span>: <span class="hljs-string">'Bienvenue !'</span>
  });

  <span class="hljs-comment">// 4. Planification récurrente</span>
  <span class="hljs-keyword">await</span> mailManager.scheduleJob(
    <span class="hljs-string">'emails'</span>, 
    <span class="hljs-string">'send-newsletter'</span>, 
    { <span class="hljs-attr">to</span>: <span class="hljs-string">'subscribers@example.com'</span> },
    <span class="hljs-string">'0 9 * * *'</span> <span class="hljs-comment">// Tous les jours à 9h</span>
  );

  <span class="hljs-comment">// 5. Monitoring</span>
  mailManager.onEvent(<span class="hljs-string">'emails'</span>, <span class="hljs-string">'completed'</span>, (data) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Email envoyé: <span class="hljs-subst">${data.jobId}</span>`</span>);
  });

  <span class="hljs-comment">// Nettoyage</span>
  <span class="hljs-keyword">await</span> mailManager.shutdown();
}
</div></code></pre>
<h3 id="exemple-avec-workflows">Exemple avec workflows</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">workflowUsage</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> mailManager = <span class="hljs-keyword">new</span> MailManager({ <span class="hljs-attr">redis</span>: { <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>, <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span> } });
  <span class="hljs-keyword">await</span> mailManager.initialize();

  mailManager.createQueue(<span class="hljs-string">'email-processing'</span>);
  
  <span class="hljs-keyword">const</span> handlers = {
    ...WorkerManager.createEmailHandlers(),
    ...FlowManager.createFlowHandlers()
  };
  
  mailManager.startWorker(<span class="hljs-string">'email-processing'</span>, handlers);

  <span class="hljs-comment">// Workflow d'email avec validation</span>
  <span class="hljs-keyword">const</span> emailFlow = <span class="hljs-keyword">await</span> mailManager.addFlow({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'email-workflow'</span>,
    <span class="hljs-attr">queueName</span>: <span class="hljs-string">'email-processing'</span>,
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'workflow'</span> },
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'validate-email'</span>,
        <span class="hljs-attr">queueName</span>: <span class="hljs-string">'email-processing'</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">to</span>: <span class="hljs-string">'test@example.com'</span> }
      },
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'prepare-template'</span>,
        <span class="hljs-attr">queueName</span>: <span class="hljs-string">'email-processing'</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">template</span>: <span class="hljs-string">'welcome'</span> },
        <span class="hljs-attr">children</span>: [
          {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'send-welcome'</span>,
            <span class="hljs-attr">queueName</span>: <span class="hljs-string">'email-processing'</span>,
            <span class="hljs-attr">data</span>: { <span class="hljs-attr">to</span>: <span class="hljs-string">'test@example.com'</span> }
          }
        ]
      }
    ]
  });

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Workflow créé:'</span>, emailFlow.flowId);
}
</div></code></pre>
<h2 id="%F0%9F%93%8A-clarification-des-concepts-bullmq">📊 Clarification des Concepts BullMQ</h2>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Rôle</th>
<th>Géré par</th>
<th>Automatique</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Queue</strong></td>
<td>Stocke les jobs</td>
<td>QueueManager</td>
<td>✅</td>
</tr>
<tr>
<td><strong>QueueScheduler</strong></td>
<td>Gère jobs delayed/recurring</td>
<td>QueueManager</td>
<td>✅ Créé automatiquement</td>
</tr>
<tr>
<td><strong>Worker</strong></td>
<td>Traite les jobs</td>
<td>WorkerManager</td>
<td>Configuration requise</td>
</tr>
<tr>
<td><strong>QueueEvents</strong></td>
<td>Écoute les événements</td>
<td>EventManager</td>
<td>✅ Créé à la demande</td>
</tr>
<tr>
<td><strong>FlowProducer</strong></td>
<td>Crée des workflows</td>
<td>FlowManager</td>
<td>✅</td>
</tr>
</tbody>
</table>
<h3 id="%E2%9D%97-points-importants">❗ Points importants</h3>
<ul>
<li><strong>Un scheduler par queue</strong> : Automatiquement créé et géré</li>
<li><strong>Events vs Workers</strong> : Events = monitoring, Workers = traitement</li>
<li><strong>Flow vs Queue</strong> : Flow = workflow complexe, Queue = jobs simples</li>
</ul>
<h2 id="%F0%9F%94%84-patterns-disponibles">🔄 Patterns Disponibles</h2>
<h3 id="jobs-simples">Jobs simples</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">await</span> mailManager.addJob(<span class="hljs-string">'emails'</span>, <span class="hljs-string">'send-welcome'</span>, data);
</div></code></pre>
<h3 id="jobs-planifi%C3%A9s-avec-scheduler-automatique">Jobs planifiés (avec scheduler automatique)</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">await</span> mailManager.scheduleJob(<span class="hljs-string">'emails'</span>, <span class="hljs-string">'send-newsletter'</span>, data, <span class="hljs-string">'0 9 * * *'</span>);
</div></code></pre>
<h3 id="workflows-avec-d%C3%A9pendances">Workflows avec dépendances</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">await</span> mailManager.addFlow(flowDefinition);
</div></code></pre>
<h3 id="handlers-demails-pr%C3%A9-d%C3%A9finis">Handlers d'emails pré-définis</h3>
<ul>
<li><code>send-welcome</code> : Email de bienvenue</li>
<li><code>send-newsletter</code> : Newsletter</li>
<li><code>send-reset-password</code> : Réinitialisation mot de passe</li>
<li><code>send-notification</code> : Notifications</li>
</ul>
<h3 id="flows-pr%C3%A9-d%C3%A9finis">Flows pré-définis</h3>
<ul>
<li><code>createEmailFlow()</code> : Email avec validation</li>
<li><code>createNewsletterFlow()</code> : Newsletter multi-destinataires</li>
<li><code>createConditionalFlow()</code> : Workflow conditionnel</li>
<li><code>createRetryFlow()</code> : Retry intelligent</li>
</ul>
<h2 id="%F0%9F%93%88-monitoring-et-m%C3%A9triques">📈 Monitoring et Métriques</h2>
<pre class="hljs"><code><div><span class="hljs-comment">// État de santé global</span>
<span class="hljs-keyword">const</span> health = <span class="hljs-keyword">await</span> mailManager.healthCheck();

<span class="hljs-comment">// Statistiques d'une queue</span>
<span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> mailManager.getQueueStats(<span class="hljs-string">'emails'</span>);

<span class="hljs-comment">// Métriques complètes</span>
<span class="hljs-keyword">const</span> allMetrics = <span class="hljs-keyword">await</span> mailManager.queueManager.getAllQueueMetrics();
<span class="hljs-keyword">const</span> flowMetrics = mailManager.flowManager.getFlowMetrics();
<span class="hljs-keyword">const</span> eventStats = mailManager.eventManager.getEventStats();

<span class="hljs-comment">// Audit log</span>
mailManager.eventManager.setupAuditListeners();
<span class="hljs-keyword">const</span> auditLog = mailManager.eventManager.getAuditLog(<span class="hljs-number">100</span>);
</div></code></pre>
<h2 id="%F0%9F%9B%A0%EF%B8%8F-configuration-avanc%C3%A9e">🛠️ Configuration Avancée</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">redis</span>: {
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>,
    <span class="hljs-comment">// Ou utiliser une URL : url: 'redis://localhost:6379'</span>
  },
  <span class="hljs-attr">defaultOptions</span>: {
    <span class="hljs-attr">attempts</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">backoff</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'exponential'</span>, <span class="hljs-attr">delay</span>: <span class="hljs-number">2000</span> },
    <span class="hljs-attr">removeOnComplete</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">removeOnFail</span>: <span class="hljs-number">50</span>
  }
};

<span class="hljs-keyword">const</span> mailManager = <span class="hljs-keyword">new</span> MailManager(config);
</div></code></pre>
<h2 id="%F0%9F%94%8D-handlers-personnalis%C3%A9s">🔍 Handlers Personnalisés</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> customHandlers = {
  <span class="hljs-string">'my-custom-job'</span>: <span class="hljs-keyword">async</span> (data, job) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Traitement custom: <span class="hljs-subst">${data.id}</span>`</span>);
    
    <span class="hljs-comment">// Mise à jour du progrès</span>
    <span class="hljs-keyword">await</span> job.updateProgress(<span class="hljs-number">50</span>);
    
    <span class="hljs-comment">// Logique métier</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> processData(data);
    
    <span class="hljs-keyword">await</span> job.updateProgress(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">return</span> result;
  }
};

mailManager.startWorker(<span class="hljs-string">'my-queue'</span>, customHandlers);
</div></code></pre>
<h2 id="%F0%9F%93%81-structure-du-projet">📁 Structure du Projet</h2>
<pre class="hljs"><code><div>bullMQ_examples/
├── core/                    # Architecture principale
│   ├── MailManager.js      # Interface unifiée
│   ├── QueueManager.js     # Gestion queues + schedulers
│   ├── WorkerManager.js    # Gestion workers + handlers
│   ├── EventManager.js     # Système d'événements
│   └── FlowManager.js      # Workflows complexes
├── examples/               # Exemples d'utilisation
│   └── basic-usage.js      # Exemples complets
├── scheduler.js            # Exemple de planification
└── main.js                 # Interface Bull Board
</div></code></pre>
<h2 id="%F0%9F%A7%AA-tests-et-exemples">🧪 Tests et Exemples</h2>
<pre class="hljs"><code><div><span class="hljs-comment"># Exemple basique</span>
node examples/basic-usage.js

<span class="hljs-comment"># Scheduler</span>
node scheduler.js

<span class="hljs-comment"># Interface de monitoring</span>
node main.js  <span class="hljs-comment"># http://localhost:3000</span>
</div></code></pre>
<h2 id="%E2%9A%A1-performances">⚡ Performances</h2>
<ul>
<li><strong>Concurrence configurable</strong> par worker</li>
<li><strong>Nettoyage automatique</strong> des anciens jobs</li>
<li><strong>Retry exponentiel</strong> intelligent</li>
<li><strong>Monitoring des performances</strong> intégré</li>
<li><strong>Audit log</strong> avec rotation automatique</li>
</ul>
<h2 id="%F0%9F%94%90-gestion-derreurs">🔐 Gestion d'Erreurs</h2>
<ul>
<li>Retries automatiques avec backoff exponentiel</li>
<li>Monitoring des échecs récurrents</li>
<li>Alertes pour les jobs problématiques</li>
<li>Isolation des erreurs par queue</li>
<li>Logs détaillés pour le debug</li>
</ul>
<h2 id="%F0%9F%93%A6-migration-depuis-bullmq-classique">📦 Migration depuis BullMQ Classique</h2>
<pre class="hljs"><code><div><span class="hljs-comment">// Avant (BullMQ classique)</span>
<span class="hljs-keyword">const</span> { Queue, Worker, QueueScheduler } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bullmq'</span>);
<span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">'emails'</span>);
<span class="hljs-keyword">const</span> scheduler = <span class="hljs-keyword">new</span> QueueScheduler(<span class="hljs-string">'emails'</span>);
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">'emails'</span>, processor);

<span class="hljs-comment">// Après (Architecture unifiée)</span>
<span class="hljs-keyword">const</span> mailManager = <span class="hljs-keyword">new</span> MailManager();
<span class="hljs-keyword">await</span> mailManager.initialize();
mailManager.createQueue(<span class="hljs-string">'emails'</span>);  <span class="hljs-comment">// Scheduler créé automatiquement</span>
mailManager.startWorker(<span class="hljs-string">'emails'</span>, handlers);
</div></code></pre>
<h2 id="%F0%9F%9A%80-int%C3%A9gration-dans-une-application-existante">🚀 Intégration dans une Application Existante</h2>
<ol>
<li><strong>Copier le dossier <code>core/</code></strong> dans votre projet</li>
<li><strong>Installer les dépendances</strong> : <code>npm install bullmq ioredis</code></li>
<li><strong>Initialiser MailManager</strong> dans votre application</li>
<li><strong>Remplacer les appels BullMQ</strong> par l'interface MailManager</li>
<li><strong>Configurer les handlers</strong> pour vos types d'emails</li>
</ol>
<h2 id="%F0%9F%93%8B-api-r%C3%A9f%C3%A9rence">📋 API Référence</h2>
<h3 id="mailmanager">MailManager</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Initialisation</span>
<span class="hljs-keyword">await</span> mailManager.initialize()
<span class="hljs-keyword">await</span> mailManager.shutdown()

<span class="hljs-comment">// Queues</span>
mailManager.createQueue(name, options)
<span class="hljs-keyword">await</span> mailManager.addJob(queueName, jobName, data, options)
<span class="hljs-keyword">await</span> mailManager.scheduleJob(queueName, jobName, data, cronPattern, options)

<span class="hljs-comment">// Workers</span>
mailManager.startWorker(queueName, handlers, options)

<span class="hljs-comment">// Flows</span>
<span class="hljs-keyword">await</span> mailManager.addFlow(flowDefinition)

<span class="hljs-comment">// Events</span>
mailManager.onEvent(queueName, eventType, callback)

<span class="hljs-comment">// Monitoring</span>
<span class="hljs-keyword">await</span> mailManager.getQueueStats(queueName)
<span class="hljs-keyword">await</span> mailManager.healthCheck()
</div></code></pre>
<h2 id="%F0%9F%93%84-licence">📄 Licence</h2>
<p>ISC</p>
<hr>
<p><strong>💡 Cette architecture résout la confusion entre les concepts BullMQ en fournissant une interface claire et unifiée. Plus besoin de gérer manuellement schedulers, events et workers !</strong></p>

</body>
</html>
